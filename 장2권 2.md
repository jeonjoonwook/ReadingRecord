2.1 공통 개념

DAO패턴
의미 있는 비즈니스 로직을 가진 엔터프라이즈 애플리케이션이라면 데이터 액세스 계층을 DAO패턴으로 분리해야함

DAO패턴은 DTO을 사용하는 인터페이스를 통해 데이터 액세스 기술을 외부에 노출하지 않도록 만드는것
이를 통해 DAO를 사용하는 코드에 영향 주지 않고 데이터 액세스 기술을 변경하거나 하나 이상의 데이터 액세스 기술을 혼합해서 사용가능

DAO인터페이스와 DI
DAO 인터페이스를 이용해 접근하고 DI되도록 만들어야 함. DAO 인터페이스에는 구체적인 데이터 액세스 기술과 관련된 api나 정보 노출x
인터페이스를 만들때 public 메소드를 추가할때 유의 해야함 , 서비스 계층 코드에서 의미 있는 메소드만 인터페이스로 공개

예외처리
데이터 액세스 중에 발생하는 예외는 대부분 복구할수 없음, 따라서 DAO 밖으로 던져질 때는 런타임 예외여야함
서비스 계층 코드는 DAO가 던지는 대부분의 예외는 직접 다뤄야 할 이유가 없음

때로는 DAO가 던지는 예외를 잡아서 비즈니스 로직에 적용하는 경우가 있음
그런데 구현 기술에 따라 달라지는 예외를 서비스 계층에서 알고있어야 한다는 문제가 있음
스프링은 특정 기술이나 DB 종류에 상관없이 일관된 의미를 갖는 데이터 예외 추상화 제공

템플릿과 API
데이터 액세스 기술을 사용하는 코드는 대부분 try/catch/finally 구조임->코드가 길고 지저분
스프링은 꼭 필요한 바뀌는 내용만을 담을 수 있도록 데이터 액세스 기술을 위한 템플릿 제공

DataSource
db 사용시 Connection 타입의 DB 연결오브젝트 필요
미리 정해진 개수 만큼의 DB 커넥션을 pool에 준비해두고, 애플리케이션이 요청할 때마다 풀에서 꺼내 하나씩 할당해주고
다시 돌려 받아서 풀에 넣음

스프링에서는 DataSource를 하나의 득립된 빈으로 등록하도록 권장
다양한 서비스에서 Datasource를 필요로 하기 때문에 공유 가능해야 함

JDBC
JDBC는 자바의 데이터 액세스 기술의 기본이 되는 로우레벨 API임
JDBC로 개발한 코드는 DB가 변경돼도 그대로 재사용 가능

JDBC는 코드가 매우 번잡하고 SQL을 코드 내에서 문자로 써야함
스프링 JDBC는 JDBC 개발의 장점을 유지하면서 템플릿/콜백 패턴으로 JDBC 단점 극복, 가장 간결한 형태의 API사용법 제공

스프링 JDBC가 해주는 작업
Connection 열기와 닫기
Statement준비와 닫기
Statement실행
ResultSet 루프
예외처리와 변환 ex) SQLException을 런타임 예외인 DataAccessException으로 변환
트랜잭션 처리

SimpleJdbcTemplate
DataSource를 개발자가 정의해두고 빈으로 등록한 후 SimpleJdbcTemplate의 인자로 넣어줌

SQL 파라미터
?를 활용해 치환자를 두고 파라미터를 바인딩하는 방식 사용
map 오브젝트를 이용해서 파라미터를 바인딩 시킬수도 있음

SQL 배치 메소드
SQL 배치 메소드는 update()로 실행하는 SQL들을 배치 모드로 실행하게 해줌
여러개의 SQL을  한번에 처리
많은 SQL을 실행해야 하는 경우 배치 방식을 사용하면 DB호출을 최소화 할수 있기에 성능 향상

SimpleJdbcInsert
모든 컬럼 정보를 다 적어야 하는 Insert문은 번거로움
insert문의 작성을 간편하게 만들어줌

SimpleJdbcCall생성
DB에 생성해둔 저장 프로시저 또는 저장 펑션을 호출할때 사용

스프링 JDBC DAO
가장 권장되는 DAO 작성 방법은 DAO는 DataSource에만 의존하게 만들고 
스프링 JDBC오브젝트는 코드를 이용해 직접 생성하거나 초기화해서 DAO의 인스턴스 변수에 저장해두고 사용

SimpleJdbcTemplate은 모든 DAO에서 동일하게 생성되므로 중복처럼 보임
해결1 SimpleJdbcTemplate을 독립적인 빈으로 등록하고 주입
해결2 DAO의 공통코드를 뽑아내 추상 클래스를 만들어 두고 모든 DAO가 이를 상속하게 하는 것 ,
 SimpleJdbcTemplate 생성이나 DataSource의 주입은 슈퍼 클래스에서 처리

iBatis SqlMaps
자바 오브젝트와 SQL문 사이의 자동매핑 기능 지원 
SQL을 별도의 파일로 분리해서 관리
도메인 오브젝트나 DTO 중심으로 개발 가능

